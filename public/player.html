<!doctype html>
<html><head><meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
<title>Player ¬∑ Time-Bank Auction</title>
<style>
  :root{ --bg:#0e0f12; --fg:#f2f3f7; --muted:#9aa0a6; --accent:#10b981; --danger:#ef4444; --disabled:#4b5563; }
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;display:flex;align-items:center;justify-content:center}
  .wrap{max-width:560px;width:100%;padding:20px}
  .card{background:#12151b;border:1px solid #1f2632;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .pad{padding:18px}
  h1{font-size:18px;margin:0 0 8px}
  .muted{color:#9aa0a6;font-size:13px}
  .row{display:flex;gap:10px;align-items:center}
  input,button{font:inherit}
  input[type=text]{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #2a3444;background:#0b0e13;color:var(--fg)}
  .btn{padding:12px 16px;border-radius:14px;border:1px solid #334155;background:#0b0e13;color:var(--fg)}
  .btn.primary{background:var(--accent);color:#00160e;border-color:#08946d}
  .text-link{background:none;border:0;padding:0;color:#93c5fd;text-decoration:underline;font:inherit;font-size:13px;cursor:pointer}
  .center{display:flex;align-items:center;justify-content:center}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}

  /* Phase Bar */
  .phaseBar{display:flex;align-items:center;gap:10px;margin:8px 0 6px}
  .phaseBadge{font-weight:700;font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid transparent}
  .phaseCopy{color:#9aa0a6;font-size:13px}
  .ph-idle{background:#0f172a;color:#e2e8f0;border-color:#1f2937}
  .ph-arming{background:#f59e0b20;color:#fbbf24;border-color:#f59e0b55}
  .ph-countdown{background:#fb923c20;color:#fdba74;border-color:#fb923c55}
  .ph-active{background:#10b98120;color:#34d399;border-color:#10b98155}
  .ph-ended{background:#6d28d920;color:#c4b5fd;border-color:#6d28d955}
  .ph-exhausted{background:#4b556320;color:#cbd5e1;border-color:#4b556355}

  /* Circular hold button */
  .hold.bonus{ background:#231a00; border-color:#d4af37; box-shadow:0 0 0 2px rgba(212,175,55,.25) inset; }
  .hold{ width:min(72vw, 420px); height:min(72vw, 420px); max-width:420px; max-height:420px; min-width:220px; min-height:220px; border-radius:9999px; margin:18px auto 6px; display:flex; align-items:center; justify-content:center; user-select:none; -webkit-user-select:none; touch-action:manipulation; border:6px solid transparent; transition:transform .08s ease, background .15s ease, border-color .15s ease, opacity .15s ease; }
  .hold.idle{ background:#1a0f12; border-color:var(--danger); }
  .hold.pressed{ background:#0f1a14; border-color:var(--accent); }
  .hold.disabled{ background:#101318; border-color:var(--disabled); opacity:.6; }
  .hold:active{ transform:scale(.985); }
  .hold.no-hold{ background:#1f0b12; border-color:#f87171; box-shadow:0 0 0 4px rgba(248,113,113,.25); animation:noHoldPulse 1.4s ease-in-out infinite; }
  .hold.no-hold .holdText{ color:#fee2e2; }
  .hold.no-hold .holdSub{ color:#fecaca; }
  .holdText{ font-size:22px; opacity:.92; text-align:center; }
  .holdSub{ color:#9aa0a6; font-size:12px; margin-top:6px; text-align:center; }
  .round-result{ margin-top:10px; font-size:14px; color:var(--muted); font-weight:500; transition:color .2s ease, text-shadow .35s ease; }
  .round-result.round-result--alert{ color:#fecaca; font-weight:700; text-shadow:0 0 12px rgba(248,113,113,.45); }

  /* Countdown overlay */
  #countdownOverlay{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.35); }
  #countdownDigit{ font-size:72px; font-weight:800; color:#f8fafc; text-shadow:0 6px 24px rgba(0,0,0,.45); }

  .toast{position:fixed;bottom:16px;left:50%;transform:translateX(-50%);background:#0b0e13;border:1px solid #2a3444;color:#f8fafc;padding:12px 14px;border-radius:12px}

  /* Public scoreboard */
  #publicScoreCard{ display:none; margin-top:14px }
  #publicScoreCard table{ width:100%; border-collapse:collapse }
  #publicScoreCard th,#publicScoreCard td{ border-bottom:1px solid #1f2632; padding:6px 8px; text-align:left }
  #publicScoreCard .rank{ width:1%; white-space:nowrap; }

  /* Final modal */
  #finalModal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.6); padding:20px; }
  #finalCard{ max-width:760px; width:100%; background:#0b0e13; border:1px solid #2a3444; border-radius:18px; box-shadow:0 12px 32px rgba(0,0,0,.45); }
  #finalCard .pad{ padding:16px 18px; }
  #finalCard h2{ margin:0 0 6px; }
  #finalTable{ max-height:60vh; overflow:auto; }
  #finalTable table{ width:100%; border-collapse:collapse }
  #finalTable th,#finalTable td{ border-bottom:1px solid #1f2632; padding:6px 8px; text-align:left }

  /* P210 layout guard */
  :root { --hud-h: 56px; }
  header,.top,.top-bar,.hud,.status-bar{ position:sticky; top:env(safe-area-inset-top); z-index:100; backdrop-filter:blur(6px); background:rgba(10,15,26,.6) }
  .public-scoreboard,#publicScoreboard,.scoreboard,[data-role="public-scoreboard"]{ max-height:calc(100dvh - var(--hud-h) - 16px - env(safe-area-inset-top)); overflow-y:auto; overscroll-behavior:contain; -webkit-overflow-scrolling:touch }

  /* P213 splash */
  :root{ --splash-bg: linear-gradient(180deg, #0b1223 0%, #0a0f1a 100%); }
  .splash{ position:relative; min-height:60dvh; display:flex; align-items:center; justify-content:center; text-align:center; padding:calc(16px + env(safe-area-inset-top)) 16px 12px; }
  .splash-bg{ position:absolute; inset:0; background:var(--splash-bg); }
  .splash-inner{ position:relative; z-index:1; max-width:720px; color:#e6f0ff }
  .splash-title{ margin:.6rem 0 .6rem; font-size:clamp(28px, 6vw, 48px); font-weight:800; letter-spacing:.2px }
  .splash-cta{ display:flex; gap:10px; justify-content:center; align-items:center; flex-wrap:wrap }
  .btn.primary{ background:#124c3a; color:#001; border:0; padding:.7rem 1rem; border-radius:12px; font-weight:800; cursor:pointer }
  .link{ color:#93c5fd; text-decoration:underline }

  /* Round recap panel */
  #roundRecapPanel{position:fixed;inset:0;display:flex;align-items:flex-end;justify-content:center;padding:16px 18px 24px;z-index:220;pointer-events:none;transition:visibility .28s ease;visibility:hidden}
  #roundRecapPanel.show{visibility:visible;pointer-events:auto}
  #roundRecapPanel .round-recap{max-width:540px;width:100%;background:#0b0f18;border:1px solid #1f2632;border-radius:20px;box-shadow:0 18px 48px rgba(0,0,0,.45);overflow:hidden;transform:translateY(32px);opacity:0;transition:transform .28s ease,opacity .28s ease;pointer-events:auto}
  #roundRecapPanel.show .round-recap{transform:translateY(0);opacity:1}
  #roundRecapPanel.closing .round-recap{transform:translateY(32px);opacity:0}
  #roundRecapPanel.alert .round-recap__header{background:linear-gradient(135deg,#3f1f2a 0%,#2a0e15 80%,#220910 100%);color:#ffe4e6}
  #roundRecapPanel.alert .round-recap__subtitle{color:#fecaca}
  #roundRecapPanel.alert .round-recap__summary{color:#ffd7dc}
  .round-recap__header{display:flex;align-items:flex-start;justify-content:space-between;gap:14px;padding:16px 18px;background:linear-gradient(135deg,#1f2a44 0%,#122035 65%,#101829 100%);color:#e2e8f0}
  .round-recap__title{margin:0;font-size:16px;font-weight:700;letter-spacing:.01em}
  .round-recap__subtitle{margin-top:4px;font-size:13px;color:#cbd5f5;opacity:.9}
  .round-recap__body{padding:16px 18px;display:grid;gap:14px}
  .round-recap__summary{font-size:14px;line-height:1.5;color:#cbd5f5}
  .round-recap__stats{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(150px,1fr))}
  .round-recap__stat{background:#121722;border:1px solid #1f2632;border-radius:16px;padding:12px 14px;min-height:84px;display:flex;flex-direction:column;justify-content:space-between}
  .round-recap__label{font-size:11px;letter-spacing:.08em;text-transform:uppercase;color:#8fa0ba}
  .round-recap__value{font-size:18px;font-weight:700;color:#f8fafc;margin-top:6px;word-break:break-word}
  .round-recap__note{font-size:12px;color:#94a3b8;margin-top:4px}
  .round-recap__footer{padding:0 18px 18px;display:flex;justify-content:flex-end;flex-wrap:wrap;gap:10px}
  .round-recap__footer-note{color:#94a3b8;font-size:12px;margin-right:auto;min-height:18px}
  .round-recap__dismiss{padding:6px 14px;border-radius:999px;border:1px solid #2a3444;background:rgba(15,23,42,.65);color:#cbd5f5;font-size:12px;cursor:pointer;transition:background .2s ease,border-color .2s ease}
  .round-recap__dismiss:hover{background:rgba(15,23,42,.85);border-color:#334155}
  @media (max-width:520px){
    .round-recap__body{padding:14px 16px}
    .round-recap__footer{padding:0 16px 16px}
    .round-recap__stats{grid-template-columns:1fr 1fr}
  }
  @media (max-width:420px){
    .round-recap__stats{grid-template-columns:1fr}
    .round-recap__dismiss{width:100%;text-align:center}
  }

  #nextReadyPanel{display:none;margin-top:12px;padding:12px;border:1px solid #1f2632;border-radius:14px;background:#11141c}
  #nextReadyPanel .title{font-weight:700;font-size:14px;margin-bottom:4px}
  #nextReadyStatus{color:#9aa0a6;font-size:13px}
  #nextReadyCountdownPlayer{display:none;margin-top:8px;padding:4px 10px;border-radius:999px;background:#1f2632;color:#e5e7eb;font-size:12px}
  #toggleReadyBtn.ready{background:#1f2632;color:#e5e7eb;border-color:#1f2632}


  /* Heartbeat pulse */
  @keyframes hbBeat { 0%{transform:scale(1)} 40%{transform:scale(1.03)} 100%{transform:scale(1)} }
  .hold.hb-beat { animation: hbBeat 180ms ease-out; box-shadow: 0 0 0 0 rgba(16,185,129,.35); }
  @keyframes noHoldPulse { 0%{box-shadow:0 0 0 4px rgba(248,113,113,.28);} 50%{box-shadow:0 0 0 12px rgba(248,113,113,.12);} 100%{box-shadow:0 0 0 4px rgba(248,113,113,.28);} }

</style>
</head>
<body>

<div class="wrap">
    <div class="card pad" id="joinCard">
      <h1>Join or Resume</h1>
      <div class="muted">Enter a name to join for the first time, or resume with your saved PIN.</div>
      <div id="savedSession" class="muted" style="display:none;margin-top:8px"></div>
      <div class="row" style="margin-top:10px">
        <input id="name" type="text" maxlength="24" placeholder="Your name"/>
        <button id="join" class="btn primary">Join</button>
      </div>
      <div id="nameHelper" class="muted" style="margin-top:6px">We‚Äôll generate your PIN right after launch.</div>
      <button id="showResume" class="text-link" type="button" style="margin-top:8px;display:none">Have a PIN?</button>
      <div id="resumeGroup" style="display:none;margin-top:10px">
        <div class="row">
          <input id="pin" type="text" maxlength="6" placeholder="Your PIN (4‚Äì5 digits)"/>
          <button id="reconnect" class="btn">Resume</button>
        </div>
      </div>
      <div id="statusMsg" class="muted" style="margin-top:12px;display:none"></div>
    </div>

    <div class="card pad" id="gameCard" style="display:none">
      <div class="row" style="justify-content:space-between">
        <div>
          <div class="muted">Player</div>
          <div id="playerName" style="font-weight:700"></div>
          <div class="muted" style="font-size:12px">Your PIN: <span id="myPin" class="mono"></span></div>
        </div>
        <div style="text-align:right">
          <div class="muted">Victory tokens</div>
          <div id="tokenCount" style="font-weight:700;text-align:right">üèÜ 0</div>
        </div>
      </div>

      <!-- Phase Bar -->
      <div id="phaseBar" class="phaseBar" role="status" aria-live="polite">
        <span id="phaseBadge" class="phaseBadge ph-idle">Idle</span>
        <span id="phaseCopy" class="phaseCopy">Waiting for host‚Ä¶</span>
      </div>

      <!-- Round timer (Active phase) -->
      <div class="muted">Round timer: <span id="roundTimer" class="mono">00:00.000</span></div>

      <div id="holdArea" class="hold idle" role="button" aria-pressed="false" aria-label="Press and hold">
        <div><div id="holdText" class="holdText">Press & Hold</div><div id="holdSub" class="holdSub">Release = out (this round)</div></div>
      </div>

      <div id="exhaustedMsg" class="toast" style="display:none">Your time bank is exhausted. You are spectating.</div>
      <div id="roundResult" class="muted round-result"></div>

      <div id="nextReadyPanel">
        <div class="title">Next round</div>
        <div id="nextReadyStatus">Ready 0 / 0</div>
        <div class="row" style="gap:10px;margin-top:8px;flex-wrap:wrap">
          <button id="toggleReadyBtn" class="btn primary">I'm ready</button>
          <span id="nextReadyCountdownPlayer"></span>
        </div>
      </div>

      <div id="publicScoreCard" class="card pad">
        <h3>Scoreboard</h3>
        <div id="publicScoreTable"></div>
      </div>
    </div>
  </div>

  <div id="countdownOverlay" class="center"><div id="countdownDigit">5</div></div>

  <!-- Final Modal -->
  <div id="finalModal" class="center">
    <div id="finalCard" class="card">
      <div class="pad">
        <h2>Final Results</h2>
        <div id="finalChampion" class="muted">Champion: ‚Äî</div>
      </div>
      <div id="finalTable" class="pad">
        <div id="finalTableInner"></div>
      </div>
      <div class="pad" style="text-align:right">
        <button id="closeFinal" class="btn">Close</button>
      </div>
    </div>
  </div>

  <div id="roundRecapPanel" aria-live="polite" aria-atomic="false">
    <div class="round-recap" role="region" aria-labelledby="roundRecapTitle">
      <div class="round-recap__header">
        <div>
          <div id="roundRecapTitle" class="round-recap__title">Round recap</div>
          <div id="roundRecapSubtitle" class="round-recap__subtitle"></div>
        </div>
      </div>
      <div id="roundRecapLive" class="round-recap__body" aria-live="polite" aria-atomic="false">
        <div id="roundRecapSummary" class="round-recap__summary"></div>
        <div class="round-recap__stats">
          <div class="round-recap__stat">
            <div class="round-recap__label">Leader</div>
            <div id="roundRecapLeader" class="round-recap__value">‚Äî</div>
            <div id="roundRecapLeaderNote" class="round-recap__note"></div>
          </div>
          <div class="round-recap__stat">
            <div class="round-recap__label">Your gap</div>
            <div id="roundRecapGap" class="round-recap__value">‚Äî</div>
            <div id="roundRecapGapNote" class="round-recap__note"></div>
          </div>
          <div class="round-recap__stat" id="roundRecapBonusStat">
            <div class="round-recap__label">Bonus</div>
            <div id="roundRecapBonus" class="round-recap__value">‚Äî</div>
            <div id="roundRecapBonusNote" class="round-recap__note"></div>
          </div>
          <div class="round-recap__stat">
            <div class="round-recap__label">Rounds left</div>
            <div id="roundRecapRoundsLeft" class="round-recap__value">‚Äî</div>
            <div id="roundRecapRoundsLeftNote" class="round-recap__note"></div>
          </div>
        </div>
      </div>
      <div class="round-recap__footer">
        <span id="roundRecapFooterNote" class="round-recap__footer-note"></span>
        <button id="roundRecapDismiss" class="round-recap__dismiss" type="button">Close recap</button>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/public/player.js"></script>
</body></html>
